<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCFfkmEDjqAwJNtnKByRQNt9NUQs5UdNa0",
        authDomain: "rrhh-ee7e3.firebaseapp.com",
        projectId: "rrhh-ee7e3",
        storageBucket: "rrhh-ee7e3.appspot.com",
        messagingSenderId: "605891607617",
        appId: "1:605891607617:web:daedbd7b7b7b5a8b901ac0",
        measurementId: "G-Q801R9M95S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const storage = getStorage(app);

    async function cargarPerfil() {
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Obtener el documento del usuario desde Firestore
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    document.getElementById("username").innerText = userData.name || "Usuario";
                    const photoURL = userData.photoURL || "";
                    
                    // Cargar la imagen de perfil desde Firestore o usar la URL guardada
                    if (photoURL) {
                        document.getElementById("profileImage").src = photoURL;
                    } else {
                        const profileImageRef = ref(storage, `profiles/${user.uid}/${user.uid}.jpg`);
                        getDownloadURL(profileImageRef)
                            .then((url) => {
                                document.getElementById("profileImage").src = url;
                            })
                            .catch((error) => console.error("Error al cargar imagen:", error));
                    }
                }
            }
        });
    }

    // Aquí podrías incluir el resto de tus funciones como cargarConsumos y renderizarGraficos

    cargarPerfil();
    // renderizarGraficos(); // Descomentar si deseas llamar a esta función
</script>
